<!DOCTYPE html>
<html lang="en" dir=>

<head>
  <meta name="generator" content="Hugo 0.82.0" />
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Using withArg to run assertions in verify calls.">

<title>Assertions with an argument | Argument matching | MockK Guidebook</title>
<link rel="manifest" href="/mockk-guidebook/manifest.json">
<link rel="icon" href="/mockk-guidebook/favicon.png" sizes="48x48" type="image/png">
<link rel="icon" href="/mockk-guidebook/favicon.svg" sizes="any" type="image/svg+xml">
<link rel="stylesheet" href="/mockk-guidebook/book.min.8cc9f19857b4d60e8dd0122133898d6981cc0574d3603584833f55232a9ad1da.css" integrity="sha256-jMnxmFe01g6N0BIhM4mNaYHMBXTTYDWEgz9VIyqa0do=">
<script defer src="/mockk-guidebook/en.search.min.35c27fe7ffbf333637ccd97e32b30c055c962f719190207486c603703e1c5b79.js" integrity="sha256-NcJ/5/&#43;/MzY3zNl&#43;MrMMBVyWL3GRkCB0hsYDcD4cW3k="></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

  <meta name="monetization" content="$ilp.uphold.com/p2WKq3nJHA8w">
<script defer src="https://media.ethicalads.io/media/client/ethicalads.min.js"></script>
<script defer src='/mockk-guidebook/ads.min.js'></script>
<script defer src='/mockk-guidebook/keys.min.js'></script>

<meta property="og:title" content='Assertions with an argument' />
<meta property="og:site_name" content='MockK Guidebook' />
<meta property="og:type" content="book" />
<meta property="og:image" content='https://notwoods.github.io/mockk-guidebook/cover/mockk-bike-iso.png' />
<meta property="og:image:width" content="1280" />
<meta property="og:image:height" content="640" />
<meta property="og:url" content='https://notwoods.github.io/mockk-guidebook/docs/matching/with/' />

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:creator" content="@Not_Woods">
<meta name="twitter:title" content="Assertions with an argument | MockK Guidebook">
<meta name="twitter:image" content='https://notwoods.github.io/mockk-guidebook/cover/mockk-bike-iso.png'>
<meta name="twitter:description" content="Using withArg to run assertions in verify calls.">

</head>

<body dir=>
  <input type="checkbox" class="hidden toggle" id="menu-control" accesskey="*" />
  <input type="checkbox" class="hidden toggle" id="toc-control" accesskey="#" />
  <main class="container flex">
    <aside class="book-menu">
      
  <nav>
<h2 class="book-brand">
  <a href="/mockk-guidebook"><span>MockK Guidebook</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>



<a class="author" href="https://tigeroakes.com">
  Written by
  <svg xmlns="http://www.w3.org/2000/svg" height="32" viewBox="0 0 80 16">
    <title>Tiger Oakes</title>
    <g class="logo-icon logo-icon--monochrome">
      <g fill="none" stroke="currentColor">
        <rect width="13" height="13" x="1.5" y="1.5"/>
        <circle class="eye" cx="5" cy="6" r="1.5"/>
        <circle class="eye" cx="11" cy="6" r="1.5"/>
        <path d="M4.5,7.5v3.5l2.5,1.5m4.5,-4.9v3.4l-2.5,1.5"/>
      </g>
      <path fill="currentColor" d="M8,10.6l1.5,-1.6h-3l1.5,1.6Z"/>
    </g>
    <g class="logo-icon logo-icon--color">
      <rect width="12" height="12" x="2" y="2" fill="#e67237"/>
      <g class="logo-path" fill="none" stroke="#032030">
        <circle class="eye" cx="5" cy="6" r="1.5"/>
        <circle class="eye" cx="11" cy="6" r="1.5"/>
        <path d="M4.5,7.5v3.5l2.5,1.5m4.5,-4.9v3.4l-2.5,1.5"/>
      </g>
      <path fill="#032030" d="M8,10.6l1.5,-1.6h-3l1.5,1.6Z"/>
    </g>
    <clipPath id="i">
      <path d="M29 8v6h-3V8h3zm0-1h-3V5h3v2z"/>
    </clipPath>
    <g class="text" fill="none" stroke="currentColor" opacity="0.5">
      <path d="M23.5 13V7l-.5-.5h-3l-.5-.5V5l.5-.5h7"/>
      <path d="M28 13l-.5-.5V6" clip-path="url(#i)"/>
      <path d="M32.5,12.5h-2.5l-.5,-.5v-4l.5,-.5h3l.5,.5v7l-.5,.5h-3l-.5,-.5"/>
      <path d="M36.5,10h2l.5,-.5v-1.5l-.5,-.5h-2.5l-.5,.5v4l.5,.5h2.5l.5,-.5"/>
      <path d="M40.5,7.5l.5,.5v4l.5,.5h.5l.5,-.5v-4l.5,-.5h1.5l.5,.5"/>
      <path d="M55.5,12.5h-4.5l-.5,-.5v-7l.5,-.5h4l.5,.5v6"/>
      <path d="M57.5,8l.5,-.5h3l.5,.5v4l-.5,.5h-3l-.5,-.5v-2l.5,-.5h2"/>
      <path d="M63,13l.5,-.5v-8.5"/>
      <path d="M66.5,6v2l-.5,.5h-.5l-.5,.5v1l.5,.5h2l.5,.5v2"/>
      <path d="M71,10h2l.5,-.5v-1.5l-.5,-.5h-2.5l-.5,.5v4l.5,.5h2.5l.5,-.5"/>
      <path d="M75.5,12l.5,.5h3l.5,-.5v-1.5l-.5,-.5h-3l-.5,-.5v-1.5l.5,-.5h3l.5,.5"/>
    </g>
    <g class="text text-over" fill="none" stroke="currentColor">
      <path style="animation-delay:0.2s" d="M23.5 13V7l-.5-.5h-3l-.5-.5V5l.5-.5h7"/>
      <path style="animation-delay:0.5s" d="M28 13l-.5-.5V6" clip-path="url(#i)"/>
      <path style="animation-delay:0.8s" d="M32.5,12.5h-2.5l-.5,-.5v-4l.5,-.5h3l.5,.5v7l-.5,.5h-3l-.5,-.5"/>
      <path style="animation-delay:1.1s" d="M36.5,10h2l.5,-.5v-1.5l-.5,-.5h-2.5l-.5,.5v4l.5,.5h2.5l.5,-.5"/>
      <path style="animation-delay:1.4s" d="M40.5,7.5l.5,.5v4l.5,.5h.5l.5,-.5v-4l.5,-.5h1.5l.5,.5"/>
      <path style="animation-delay:0.2s" d="M55.5,12.5h-4.5l-.5,-.5v-7l.5,-.5h4l.5,.5v6"/>
      <path style="animation-delay:0.5s" d="M57.5,8l.5,-.5h3l.5,.5v4l-.5,.5h-3l-.5,-.5v-2l.5,-.5h2"/>
      <path style="animation-delay:0.8s" d="M63,13l.5,-.5v-8.5"/>
      <path style="animation-delay:1.1s" d="M66.5,6v2l-.5,.5h-.5l-.5,.5v1l.5,.5h2l.5,.5v2"/>
      <path style="animation-delay:1.4s" d="M71,10h2l.5,-.5v-1.5l-.5,-.5h-2.5l-.5,.5v4l.5,.5h2.5l.5,-.5"/>
      <path style="animation-delay:1.7s" d="M75.5,12l.5,.5h3l.5,-.5v-1.5l-.5,-.5h-3l-.5,-.5v-1.5l.5,-.5h3l.5,.5"/>
    </g>
  </svg>
</a>








  <ul>
<li>
  <a href="/mockk-guidebook/docs/getting-started/">Getting Started</a>
<ul>
<li>
  <a href="/mockk-guidebook/docs/getting-started/why-mocking/">Why use mocks</a></li>
<li>
  <a href="/mockk-guidebook/docs/getting-started/why-mockk/"><del>Why MockK</del></a></li>
</ul>
</li>
<li>
  <a href="/mockk-guidebook/docs/quick/android/">Android Quickstart</a></li>
<li>
  <a href="/mockk-guidebook/docs/mocking/"><strong>Mocking</strong></a>
<ul>
<li>
  <a href="/mockk-guidebook/docs/mocking/stubbing/">Stub out behaviour</a></li>
<li>
  <a href="/mockk-guidebook/docs/mocking/verify/">Verify that functions were called</a></li>
<li>
  <a href="/mockk-guidebook/docs/mocking/relax/">Automatically stub by relaxing</a></li>
<li>
  <a href="/mockk-guidebook/docs/mocking/spy/">Spy on existing classes</a></li>
<li>
  <a href="/mockk-guidebook/docs/mocking/coroutines/">Coroutines and suspend functions</a></li>
<li>
  <a href="/mockk-guidebook/docs/mocking/constructor/">Mock constructors in code you don&rsquo;t own</a></li>
<li>
  <a href="/mockk-guidebook/docs/mocking/static/">Mock singleton objects and static methods</a></li>
<li>
  <a href="/mockk-guidebook/docs/mocking/extension/">Mock top-level and extension functions</a></li>
<li>
  <a href="/mockk-guidebook/docs/mocking/clear/"><del>Clear state</del></a></li>
<li>
  <a href="/mockk-guidebook/docs/mocking/annotation/">Create many mocks quickly with annotations</a></li>
<li>
  <a href="/mockk-guidebook/docs/mocking/hierarchies/"><del>Chain mocks into hierarchies</del></a></li>
<li>
  <a href="/mockk-guidebook/docs/mocking/answers/">Create more complicated answers for stubs</a></li>
</ul>
</li>
<li>
  <a href="/mockk-guidebook/docs/matching/"><strong>Argument matching</strong></a>
<ul>
<li>
  <a href="/mockk-guidebook/docs/matching/equal/"><del>Check equality</del></a></li>
<li>
  <a href="/mockk-guidebook/docs/matching/any/"><del>Allow any argument</del></a></li>
<li>
  <a href="/mockk-guidebook/docs/matching/oftype/"><del>Argument of a certain type</del></a></li>
<li>
  <a href="/mockk-guidebook/docs/matching/with/"class=active>Assertions with an argument</a></li>
<li>
  <a href="/mockk-guidebook/docs/matching/custom/">Custom matching functions</a></li>
<li>
  <a href="/mockk-guidebook/docs/matching/capture/"><del>Capture arguments to check later</del></a></li>
<li>
  <a href="/mockk-guidebook/docs/matching/vararg/"><del>Variable arguments</del></a></li>
<li>
  <a href="/mockk-guidebook/docs/matching/compareto/">Comparables</a></li>
<li>
  <a href="/mockk-guidebook/docs/matching/combine/"><del>Combine matchers</del></a></li>
</ul>
</li>
<li>
  <a href="/mockk-guidebook/docs/mockito-migrate/"><strong>Migrating from Mockito</strong></a>
<ul>
<li>
  <a href="/mockk-guidebook/docs/mockito-migrate/create-mock/">Create a mock</a></li>
<li>
  <a href="/mockk-guidebook/docs/mockito-migrate/when/"><code>when</code> and <code>do*</code></a></li>
<li>
  <a href="/mockk-guidebook/docs/mockito-migrate/eq/"><code>eq</code></a></li>
<li>
  <a href="/mockk-guidebook/docs/mockito-migrate/any/"><code>any*</code></a></li>
<li>
  <a href="/mockk-guidebook/docs/mockito-migrate/verify/"><code>verify</code></a></li>
<li>
  <a href="/mockk-guidebook/docs/mockito-migrate/arg-that/"><code>argThat</code></a></li>
<li>
  <a href="/mockk-guidebook/docs/mockito-migrate/argument-captor/"><code>ArgumentCaptor</code></a></li>
<li>
  <a href="/mockk-guidebook/docs/mockito-migrate/void/"><code>void</code> methods</a></li>
</ul>
</li>
<li>
  <a href="/mockk-guidebook/docs/tips/"><strong>Tips</strong></a>
<ul>
<li>
  <a href="/mockk-guidebook/docs/tips/unit/">Return <code>Unit</code></a></li>
<li>
  <a href="/mockk-guidebook/docs/tips/chains/"><del>Chains</del></a></li>
<li>
  <a href="/mockk-guidebook/docs/tips/timeout/"><del>Timeouts</del></a></li>
<li>
  <a href="/mockk-guidebook/docs/tips/exclude/"><del>Exclude recording</del></a></li>
</ul>
</li>
<li>
  <a href="/mockk-guidebook/docs/method-index/">Method index</a></li>
</ul>






  
<ul>
  
  <li>
    <a href="https://github.com/NotWoods/mockk-guidebook/" target="_blank" rel="noopener">
        Github
      </a>
  </li>
  
</ul>






</nav>




  <script>(function(){var a=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(b){localStorage.setItem("menu.scrollTop",a.scrollTop)}),a.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/mockk-guidebook/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <label for="toc-control">
    
    <img src="/mockk-guidebook/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  <nav id="TableOfContents">
  <ul>
    <li><a href="#run-assertions-with-an-argument">Run assertions with an argument</a>
      <ul>
        <li><a href="#arrays-and-data-classes">Arrays and data classes</a></li>
        <li><a href="#nullable-arguments">Nullable arguments</a></li>
        <li><a href="#coroutines">Coroutines</a></li>
      </ul>
    </li>
  </ul>
</nav>


  </aside>
  
 
      </header>

      <div class="dark" data-ea-publisher="notwoodsgithubio-mockk-guidebook" data-ea-type="text" id="content-ad" data-ea-manual="true"></div>

      
  <article class="markdown"><h1 id="run-assertions-with-an-argument">
  Run assertions with an argument
  <a class="anchor" href="#run-assertions-with-an-argument">#</a>
</h1>
<p>There are some special argument matchers that can only be used when verifying that a mocked function was called. <code>withArg</code> and its variants allow you to capture an argument and run your own assertions on it without the need to set up a 
  <a href="/mockk-guidebook/docs/matching/capture/">capturing slot</a>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin"><span style="color:#66d9ef">data</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">File</span>(
  <span style="color:#66d9ef">val</span> name: String,
  <span style="color:#66d9ef">val</span> data: ByteArray
)

<span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">FileNetwork</span> {
  <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">download</span>(name: String): File
  <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">upload</span>(<span style="color:#66d9ef">file</span>: File)
}
</code></pre></div><p>When using a capturing slot, testing the <code>FileNetwork.download</code> function looks like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin"><span style="color:#66d9ef">val</span> network = mockk&lt;FileNetwork&gt;()
<span style="color:#66d9ef">val</span> slot = slot&lt;String&gt;()

every { network.download(capture(slot)) } returns mockk()

network.download(<span style="color:#e6db74">&#34;testfile&#34;</span>)

verify {
  network.download(any())
}
assertTrue(<span style="color:#e6db74">&#34;testfile&#34;</span> <span style="color:#f92672">==</span> slot.captured)
</code></pre></div><p><code>withArg</code> simplifies this code so no slot is needed.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin"><span style="color:#66d9ef">val</span> network = mockk&lt;FileNetwork&gt;()

every { network.download(any()) } returns mockk()

network.download(<span style="color:#e6db74">&#34;testfile&#34;</span>)

verify {
  network.download(withArg {
    assertTrue(<span style="color:#e6db74">&#34;testfile&#34;</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">it</span>)
  })
}
</code></pre></div><h2 id="arrays-and-data-classes">
  Arrays and data classes
  <a class="anchor" href="#arrays-and-data-classes">#</a>
</h2>
<p><code>withArg</code> can be helpful when you use arguments that aren&rsquo;t easily compared, such as a data class containing arrays. The <code>equals()</code> function on an array works differently than on a <code>List</code>. Arrays are only equal if you compare with the exact same instance, while lists are equal if all of their items are equal. Since Kotlin data classes use the <code>equals()</code> function with each property, this array behaviour affects them.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin"><span style="color:#66d9ef">val</span> expected = File(<span style="color:#e6db74">&#34;hello&#34;</span>, <span style="color:#66d9ef">data</span> = <span style="color:#e6db74">&#34;world&#34;</span>.toByteArray())

network.upload(File(<span style="color:#e6db74">&#34;hello&#34;</span>, <span style="color:#66d9ef">data</span> = <span style="color:#e6db74">&#34;world&#34;</span>.toByteArray()))

<span style="color:#75715e">// fails because the Files are not equal
</span><span style="color:#75715e"></span>verify {
  network.upload(expected)
}
</code></pre></div><p>In your test, you can choose to compare properties individually using <code>withArg</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin"><span style="color:#66d9ef">val</span> expected = File(<span style="color:#e6db74">&#34;hello&#34;</span>, <span style="color:#66d9ef">data</span> = <span style="color:#e6db74">&#34;world&#34;</span>.toByteArray())

network.upload(File(<span style="color:#e6db74">&#34;hello&#34;</span>, <span style="color:#66d9ef">data</span> = <span style="color:#e6db74">&#34;world&#34;</span>.toByteArray()))

verify {
  network.upload(withArg {
    assertTrue(expected.name <span style="color:#f92672">==</span> <span style="color:#66d9ef">it</span>.name)
    assertTrue(expected.<span style="color:#66d9ef">data</span> contentEquals <span style="color:#66d9ef">it</span>.<span style="color:#66d9ef">data</span>)
  })
}
</code></pre></div><h2 id="nullable-arguments">
  Nullable arguments
  <a class="anchor" href="#nullable-arguments">#</a>
</h2>
<p><code>withNullableArg</code> is also provided by MockK when you wish to use it with a nullable argument.</p>
<h2 id="coroutines">
  Coroutines
  <a class="anchor" href="#coroutines">#</a>
</h2>
<p>MockK provides variants with <code>withArg</code> and <code>withNullableArg</code> that allow coroutine code to be executed. These variants are <code>coWithArg</code> and <code>coWithNullableArg</code>. If your assertions call a suspend function, these variants should be used.</p>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">



  <div><a class="flex align-center" href="https://github.com/NotWoods/mockk-guidebook//commit/534949d5413fdd22fd266a423b6037b38dc2194a" title='Last modified by Tiger Oakes | April 7, 2021' target="_blank" rel="noopener">
      <img src="/mockk-guidebook/svg/calendar.svg" class="book-icon" alt="Calendar" />
      <span>April 7, 2021</span>
    </a>
  </div>



  <div>
    <a class="flex align-center" href="https://github.com/NotWoods/mockk-guidebook//edit/main/content/docs/matching/with.md" target="_blank" rel="noopener">
      <img src="/mockk-guidebook/svg/edit.svg" class="book-icon" alt="Edit" />
      <span>Edit this page</span>
    </a>
  </div>

</div>

 
        <a class="kofi" href="https://ko-fi.com/O4O645BF3" target="_blank">
  <img
    height="36"
    style="height:36px"
    loading="lazy"
    src="https://cdn.ko-fi.com/cdn/kofi2.png?v=2"
    alt="Buy Me a Coffee at ko-fi.com"
  />
</a>

      </footer>

      
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <nav class="book-toc-inner">
        
  <nav id="TableOfContents">
  <ul>
    <li><a href="#run-assertions-with-an-argument">Run assertions with an argument</a>
      <ul>
        <li><a href="#arrays-and-data-classes">Arrays and data classes</a></li>
        <li><a href="#nullable-arguments">Nullable arguments</a></li>
        <li><a href="#coroutines">Coroutines</a></li>
      </ul>
    </li>
  </ul>
</nav>

 
        <div class="dark" data-ea-publisher="notwoodsgithubio-mockk-guidebook" data-ea-type="image" id="toc-sidebar-ad" data-ea-manual="true"></div>

      </nav>
    </aside>
    
  </main>

  <script src="https://getinsights.io/static/js/insights.js"></script>
<script>
    insights.init("dRGDHrNTA8KoTJ07");
    insights.trackPages();
</script>

</body>

</html>












