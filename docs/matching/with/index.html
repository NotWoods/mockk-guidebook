<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Run assertions with an argument #   withArg withNullableArg coWithArg coWithNullableArg  There are some special argument matchers that can only be used when verifying that a mocked function was called. withArg and its variants allow you to capture an argument and run your own assertions on it without the need to set up a capturing slot.
data class File( val name: String, val data: ByteArray ) interface FileNetwork { fun download(name: String): File fun upload(file: File) } When using a capturing slot, testing the FileNetwork."><meta name=theme-color content="#FFFFFF"><meta property="og:title" content="Assertions with an argument"><meta property="og:description" content="Run assertions with an argument #   withArg withNullableArg coWithArg coWithNullableArg  There are some special argument matchers that can only be used when verifying that a mocked function was called. withArg and its variants allow you to capture an argument and run your own assertions on it without the need to set up a capturing slot.
data class File( val name: String, val data: ByteArray ) interface FileNetwork { fun download(name: String): File fun upload(file: File) } When using a capturing slot, testing the FileNetwork."><meta property="og:type" content="article"><meta property="og:url" content="https://notwoods.github.io/mockk-guidebook/docs/matching/with/"><meta property="article:modified_time" content="2020-07-08T15:41:32-07:00"><title>Assertions with an argument | MockK Guidebook</title><link rel=manifest href=/mockk-guidebook/manifest.json><link rel=icon href=/mockk-guidebook/favicon.png type=image/x-icon><link rel=stylesheet href=/mockk-guidebook/book.min.745103b237c9853dec7cc6a6930b75058c5b3c455b5b3c0b19e9a8b616058f9d.css integrity="sha256-dFEDsjfJhT3sfMamkwt1BYxbPEVbWzwLGemothYFj50="><script defer src=/mockk-guidebook/en.search.min.d825e6600934b5a3a501e0e86d622213d20c6c50f41f678acfd4c3743fae774e.js integrity="sha256-2CXmYAk0taOlAeDobWIiE9IMbFD0H2eKz9TDdD+ud04="></script><meta name=monetization content="$ilp.uphold.com/p2WKq3nJHA8w"></head><body><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><nav><h2 class=book-brand><a href=/mockk-guidebook><span>MockK Guidebook</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><a style=color:inherit href=https://tigeroakes.com><svg width="135" height="20" viewBox="0 0 88 13" xmlns="http://www.w3.org/2000/svg" fill="currentcolor" stroke="currentcolor"><title>Tiger Oakes</title><g transform="translate(.5 .5)"><path d="M0 0h12v12H0z" fill="none"/><circle cx="3" cy="4" r="1.5" fill="none"/><circle cx="9" cy="4" r="1.5" fill="none"/><path d="M2.5 5.5V9L5 10.5m4.5-4.9V9L7 10.5" fill="none"/><path d="M6 8.6 7.5 7h-3L6 8.6z" stroke="none"/><path d="M86.6 3.97a.53.53 0 01-.15.17.32.32 0 01-.2.05.5.5 0 01-.26-.08l-.33-.2a2.7 2.7 0 00-.44-.2 1.9 1.9 0 00-.6-.08c-.22.0-.4.03-.56.08-.16.05-.3.12-.4.2-.1.1-.18.2-.23.33-.06.13-.08.27-.08.42.0.2.05.35.16.47.1.13.25.24.42.33.18.1.38.17.6.24l.7.23c.23.08.46.17.7.28.22.1.42.24.6.4.18.17.32.37.42.6.1.24.16.53.16.87.0.36-.06.7-.18 1.0303a2.4 2.4 0 01-1.44 1.4 3.88 3.88 0 01-3.88-.86l.45-.73c.04-.05.08-.1.14-.13a.37.37.0 01.2-.06c.1.0.2.04.3.12s.24.16.4.26c.15.1.32.17.52.25s.44.12.73.12c.43.0.76-.1 1-.3.23-.2.35-.5.35-.885.35-.88a.82.82 0 00-.16-.52 1.3 1.3 0 00-.42-.34-.18-.1-.38-.17-.6-.24l-.7-.22a5.9 5.9 0 01-.68-.28 1.87 1.87 0 01-1.03-1.04 2.42 2.42 0 01.54-2.55c.22-.22.5-.4.83-.52a3.8 3.8 0 012.46.03 3 3 0 011.04.63l-.38.7zM35.07 6.55v3.3c-.4.3-.85.52-1.32.66s-.97.2-1.5.2c-.66.0-1.27-.1-1.8-.3.8-.3a3.77 3.77 0 01-2.26-2.18 4.4 4.4 0 01-.3-1.67.0-.6.1-1.17.3-1.68a3.8 3.8 0 012.17-2.18 5.17 5.17 0 013.48 0 3.44 3.44 0 011.23.76l-.43.7a.4.4.0 01-.27.2c-.1.0-.22.0-.35-.08l-.37-.22a3.33 3.33.0 00-1.58-.37c-.4.0-.77.08-1.1.2-.32.14-.6.33-.83.58-.23.25-.4.55-.53.9-.12.36-.18.75-.18 1.2.0.46.06.88.2 1.24a2.4 2.4.0 001.44 1.5c.33.14.7.2 1.13.2a3.1 3.1.0 001.5-.35V7.68h-11a.3.3 0 01-.23-.08.27.27 0 01-.08-.2v-.85h2.7zm24.75.0c0 .6-.1 1.16-.3 1.66a3.88 3.88.0 01-2.13 2.2c-.5.2-1.07.3-1.68.3-.62.0-1.18-.1-1.7-.3a3.83 3.83.0 01-2.14-2.2c-.2-.5-.3-1.06-.3-1.65.0-.6.1-1.15.3-1.66a3.9 3.9.0 012.14-2.2c.5-.2 1.07-.3 1.7-.3a4.57 4.57 0 012.16.55 3.72 3.72 0 011.44 1.47 4.8 4.8 0 01.52 2.14zM24.42 3.74h-2.45v6.9h-1.52v-6.9H18V2.5h6.42v1.24zm2.36 6.9h-1.52V2.48h1.52v8.13zM81.15 3.7h-3.62v2.26h2.85v1.16h-2.84v2.3h3.6v1.2h-5.12V2.5h5.13v1.2zm-39.7.0h-3.62v2.26h2.85v1.16h-2.85v2.3h3.62v1.2H36.3V2.5h5.13v1.2zm2.62 6.93h-1.5V2.5h2.48c.55.0 1 .06 1.42.17.4.12.72.28.97.48.26.2.44.46.56.74.12.3.18.6.18.955a2.24 2.24 0 01-1.03 1.96 2.8 2.8 0 01-.76.36 1.5 1.5 0 01.5.47l2.03 3h-1.37c-.26.0-.44-.1-.56-.3l-1.7-2.6a.6.6 0 00-.2-.2.74.74 0 00-.34-.06h-.65v3.17zm25.97.0h-1.5V2.5h1.5v3.4h.36c.14.0.26.0.35-.05a.6.6.0 00.24-.2l2.25-2.84c.1-.12.2-.2.3-.25s.23-.07.38-.07h1.3L72.5 5.87c-.16.2-.33.35-.5.44.12.04.23.1.33.2.1.08.2.18.3.32l2.82 3.8H74.1.8H74.1a.83.83 0 01-.4-.07.63.63 0 01-.23-.22l-2.3-3a.6.6.0 00-.24-.22c-.1-.04-.23-.06-.4-.06h-.48v3.57zm-2.13.0h-1.17a.5.5 0 01-.32-.1.6.6 0 01-.2-.24l-.6-1.66h-3.37l-.6 1.66a.54.54.0 01-.17.24c-.1.07-.2.1-.33.1h-1.18l3.2-8.13h1.55l3.2 8.13zm-9.62-4.06c0-.45-.06-.85-.18-1.2-.12-.36-.3-.66-.52-.9a2.2 2.2.0 00-.8-.57c-.32-.14-.68-.2-1.07-.2-.4.0-.76.06-1.08.2-.3.13-.58.32-.8.56-.23.25-.4.55-.52.9-.12.36-.18.76-.18 1.2.0.45.06.85.18 1.2a2.24 2.24.0 001.32 1.47c.32.13.68.2 1.08.2s.75-.07 1.07-.2c.3-.13.58-.32.8-.56.23-.25.4-.55.52-.9.12-.36.18-.76.18-1.2zm6.95 1-1-2.7.7a6.14 6.14 0 01-.3-.96 10.83 10.83 0 01-.3.97-1 2.7h2.6zm-20.2-3.9h-.97v2.7h.95c.28.0.53-.04.74-.1.2-.08.4-.18.53-.3.13-.13.23-.28.3-.45s.1-.36.1-.57c0-.4-.13-.73-.4-.95-.28-.22-.7-.33-1.25-.33z" stroke="none"/></g></svg></a><ul><li><a href=/mockk-guidebook/docs/getting-started/>Getting Started</a><ul><li><a href=/mockk-guidebook/docs/getting-started/why-mocking/><del>Why use mocks</del></a></li><li><a href=/mockk-guidebook/docs/getting-started/why-mockk/><del>Why MockK</del></a></li></ul></li><li><a href=/mockk-guidebook/docs/quick/android/>Android Quickstart</a></li><li><a href=/mockk-guidebook/docs/mocking/><strong>Mocking</strong></a><ul><li><a href=/mockk-guidebook/docs/mocking/stubbing/>Stub out behaviour</a></li><li><a href=/mockk-guidebook/docs/mocking/verify/><del>Verify that functions were called</del></a></li><li><a href=/mockk-guidebook/docs/mocking/relax/>Automatically stub by relaxing</a></li><li><a href=/mockk-guidebook/docs/mocking/spy/>Spy on existing classes</a></li><li><a href=/mockk-guidebook/docs/mocking/coroutines/>Coroutines and suspend functions</a></li><li><a href=/mockk-guidebook/docs/mocking/constructor/>Mock constructors in code you don&rsquo;t own</a></li><li><a href=/mockk-guidebook/docs/mocking/static/>Mock singleton objects and static methods</a></li><li><a href=/mockk-guidebook/docs/mocking/extension/>Mock top-level and extension functions</a></li><li><a href=/mockk-guidebook/docs/mocking/clear/><del>Clear state</del></a></li><li><a href=/mockk-guidebook/docs/mocking/annotation/>Create many mocks quickly with annotations</a></li><li><a href=/mockk-guidebook/docs/mocking/hierarchies/><del>Chain mocks into hierarchies</del></a></li><li><a href=/mockk-guidebook/docs/mocking/answers/><del>Create more complicated answers for stubs</del></a></li></ul></li><li><a href=/mockk-guidebook/docs/matching/><strong>Argument matching</strong></a><ul><li><a href=/mockk-guidebook/docs/matching/equal/><del>Check equality</del></a></li><li><a href=/mockk-guidebook/docs/matching/any/><del>Allow any argument</del></a></li><li><a href=/mockk-guidebook/docs/matching/oftype/><del>Argument of a certain type</del></a></li><li><a href=/mockk-guidebook/docs/matching/with/ class=active>Assertions with an argument</a></li><li><a href=/mockk-guidebook/docs/matching/custom/><del>Custom matching functions</del></a></li><li><a href=/mockk-guidebook/docs/matching/capture/><del>Capture arguments to check later</del></a></li><li><a href=/mockk-guidebook/docs/matching/vararg/><del>Variable arguments</del></a></li><li><a href=/mockk-guidebook/docs/matching/compareto/>Comparables</a></li><li><a href=/mockk-guidebook/docs/matching/combine/><del>Combine matchers</del></a></li></ul></li><li><a href=/mockk-guidebook/docs/mockito-migrate/><strong>Migrating from Mockito</strong></a><ul><li><a href=/mockk-guidebook/docs/mockito-migrate/create-mock/>Create a mock</a></li><li><a href=/mockk-guidebook/docs/mockito-migrate/when/><code>when</code> and <code>do*</code></a></li><li><a href=/mockk-guidebook/docs/mockito-migrate/eq/><code>eq</code></a></li><li><a href=/mockk-guidebook/docs/mockito-migrate/any/><code>any*</code></a></li><li><a href=/mockk-guidebook/docs/mockito-migrate/verify/><code>verify</code></a></li><li><a href=/mockk-guidebook/docs/mockito-migrate/arg-that/><del><code>argThat</code></del></a></li><li><a href=/mockk-guidebook/docs/mockito-migrate/argument-captor/><del><code>ArgumentCaptor</code></del></a></li><li><a href=/mockk-guidebook/docs/mockito-migrate/void/><code>void</code> methods</a></li></ul></li><li><a href=/mockk-guidebook/docs/tips/><strong>TIPs</strong></a><ul><li><a href=/mockk-guidebook/docs/tips/unit/>Return <code>Unit</code></a></li><li><a href=/mockk-guidebook/docs/tips/chains/><del>Chains</del></a></li><li><a href=/mockk-guidebook/docs/tips/timeout/><del>Timeouts</del></a></li><li><a href=/mockk-guidebook/docs/tips/exclude/><del>Exclude recording</del></a></li></ul></li></ul><ul><li><a href=https://github.com/NotWoods/mockk-guidebook/ target=_blank rel=noopener>Github</a></li></ul></nav><script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/mockk-guidebook/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Assertions with an argument</strong>
<label for=toc-control><img src=/mockk-guidebook/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#run-assertions-with-an-argument>Run assertions with an argument</a><ul><li><a href=#arrays-and-data-classes>Arrays and data classes</a></li><li><a href=#nullable-arguments>Nullable arguments</a></li><li><a href=#coroutines>Coroutines</a></li></ul></li></ul></nav></aside></header><article class=markdown><h1 id=run-assertions-with-an-argument>Run assertions with an argument
<a class=anchor href=#run-assertions-with-an-argument>#</a></h1><ul><li><code>withArg</code></li><li><code>withNullableArg</code></li><li><code>coWithArg</code></li><li><code>coWithNullableArg</code></li></ul><p>There are some special argument matchers that can only be used when verifying that a mocked function was called. <code>withArg</code> and its variants allow you to capture an argument and run your own assertions on it without the need to set up a
<a href=/mockk-guidebook/docs/matching/capture/>capturing slot</a>.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=color:#66d9ef>data</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>File</span>(
  <span style=color:#66d9ef>val</span> name: String,
  <span style=color:#66d9ef>val</span> data: ByteArray
)

<span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>FileNetwork</span> {
  <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>download</span>(name: String): File
  <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>upload</span>(file: File)
}
</code></pre></div><p>When using a capturing slot, testing the <code>FileNetwork.download</code> function looks like this:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=color:#66d9ef>val</span> network = mockk&lt;FileNetwork&gt;()
<span style=color:#66d9ef>val</span> slot = slot&lt;String&gt;()

every { network.download(capture(slot)) } returns mockk()

network.download(<span style=color:#e6db74>&#34;testfile&#34;</span>)

verify {
  network.download(any())
}
assertTrue(<span style=color:#e6db74>&#34;testfile&#34;</span> == slot.captured)
</code></pre></div><p><code>withArg</code> simplifies this code so no slot is needed.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=color:#66d9ef>val</span> network = mockk&lt;FileNetwork&gt;()

every { network.download(any()) } returns mockk()

network.download(<span style=color:#e6db74>&#34;testfile&#34;</span>)

verify {
  network.download(withArg {
    assertTrue(<span style=color:#e6db74>&#34;testfile&#34;</span> == it)
  })
}
</code></pre></div><h2 id=arrays-and-data-classes>Arrays and data classes
<a class=anchor href=#arrays-and-data-classes>#</a></h2><p><code>withArg</code> can be helpful when you use arguments that aren&rsquo;t easily compared, such as a data class containing arrays. The <code>equals()</code> function on an array works differently than on a <code>List</code>. Arrays are only equal if you compare with the exact same instance, while lists are equal if all of their items are equal. Since Kotlin data classes use the <code>equals()</code> function with each property, this array behaviour affects them.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=color:#66d9ef>val</span> expected = File(<span style=color:#e6db74>&#34;hello&#34;</span>, <span style=color:#66d9ef>data</span> = <span style=color:#e6db74>&#34;world&#34;</span>.toByteArray())

network.upload(File(<span style=color:#e6db74>&#34;hello&#34;</span>, <span style=color:#66d9ef>data</span> = <span style=color:#e6db74>&#34;world&#34;</span>.toByteArray()))

<span style=color:#75715e>// fails because the Files are not equal
</span><span style=color:#75715e></span>verify {
  network.upload(expected)
}
</code></pre></div><p>In your test, you can choose to compare properties individually using <code>withArg</code>.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=color:#66d9ef>val</span> expected = File(<span style=color:#e6db74>&#34;hello&#34;</span>, <span style=color:#66d9ef>data</span> = <span style=color:#e6db74>&#34;world&#34;</span>.toByteArray())

network.upload(File(<span style=color:#e6db74>&#34;hello&#34;</span>, <span style=color:#66d9ef>data</span> = <span style=color:#e6db74>&#34;world&#34;</span>.toByteArray()))

verify {
  network.upload(withArg {
    assertTrue(expected.name == it.name)
    assertTrue(expected.<span style=color:#66d9ef>data</span> contentEquals it.<span style=color:#66d9ef>data</span>)
  })
}
</code></pre></div><h2 id=nullable-arguments>Nullable arguments
<a class=anchor href=#nullable-arguments>#</a></h2><p><code>withNullableArg</code> is also provided by MockK when you wish to use it with a nullable argument.</p><h2 id=coroutines>Coroutines
<a class=anchor href=#coroutines>#</a></h2><p>MockK provides variants with <code>withArg</code> and <code>withNullableArg</code> that allow coroutine code to be executed. These variants are <code>coWithArg</code> and <code>coWithNullableArg</code>. If your assertions call a suspend function, these variants should be used.</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/NotWoods/mockk-guidebook//commit/e5b32adbb1e6074ceb1c65efe89a56c29658643c title="Last modified by Tiger Oakes | July 8, 2020" target=_blank rel=noopener><img src=/mockk-guidebook/svg/calendar.svg class=book-icon alt=Calendar>
<span>July 8, 2020</span></a></div><div><a class="flex align-center" href=https://github.com/NotWoods/mockk-guidebook//edit/main/content/docs/matching/with.md target=_blank rel=noopener><img src=/mockk-guidebook/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div></div></footer><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><nav id=TableOfContents><ul><li><a href=#run-assertions-with-an-argument>Run assertions with an argument</a><ul><li><a href=#arrays-and-data-classes>Arrays and data classes</a></li><li><a href=#nullable-arguments>Nullable arguments</a></li><li><a href=#coroutines>Coroutines</a></li></ul></li></ul></nav></aside></main><script src=https://getinsights.io/static/js/insights.js></script><script>insights.init("dRGDHrNTA8KoTJ07");insights.trackPages();</script></body></html>