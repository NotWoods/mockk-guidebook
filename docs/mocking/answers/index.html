<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Using answers when returns just isn&rsquo;t enough."><meta name=theme-color content="#343a40"><meta name=color-scheme content="light dark"><title>Create more complicated answers for stubs | Mocking | MockK Guidebook</title><link rel=manifest href=/mockk-guidebook/manifest.json><link rel=icon href=/mockk-guidebook/favicon.png sizes=48x48 type=image/png><link rel=icon href=/mockk-guidebook/favicon.svg sizes=any type=image/svg+xml><link rel=stylesheet href=/mockk-guidebook/book.min.66a7ae0ec09df2dfc58bfb0d30143af7a784be481cd37bc1e244295eb417133f.css integrity="sha256-ZqeuDsCd8t/Fi/sNMBQ696eEvkgc03vB4kQpXrQXEz8=" crossorigin=anonymous><script defer src=/mockk-guidebook/flexsearch.min.js></script>
<script defer src=/mockk-guidebook/en.search.min.6656608c074488bebb37b073f2f7078c1a0b366dfc28194132a556f11ef533d7.js integrity="sha256-ZlZgjAdEiL67N7Bz8vcHjBoLNm38KBlBMqVW8R71M9c=" crossorigin=anonymous></script><meta name=monetization content="$ilp.uphold.com/p2WKq3nJHA8w"><script defer src=https://media.ethicalads.io/media/client/ethicalads.min.js></script>
<script defer src=/mockk-guidebook/ads.min.js></script>
<script defer src=/mockk-guidebook/keys.min.js></script>
<script src=https://cdn.usefathom.com/script.js data-site=BZTAEHGH defer></script><meta property="og:title" content="Create more complicated answers for stubs"><meta property="og:site_name" content="MockK Guidebook"><meta property="og:type" content="book"><meta property="og:image" content="https://notwoods.github.io/mockk-guidebook/cover/mockk-bike-iso.png"><meta property="og:image:width" content="1280"><meta property="og:image:height" content="640"><meta property="og:url" content="https://notwoods.github.io/mockk-guidebook/docs/mocking/answers/"><meta name=twitter:card content="summary_large_image"><meta name=twitter:creator content="@Not_Woods"><meta name=twitter:title content="Create more complicated answers for stubs | MockK Guidebook"><meta name=twitter:image content="https://notwoods.github.io/mockk-guidebook/cover/mockk-bike-iso.png"><meta name=twitter:description content="Using answers when returns just isn&rsquo;t enough."></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control accesskey=*>
<input type=checkbox class="hidden toggle" id=toc-control accesskey=#><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/mockk-guidebook/><span>MockK Guidebook</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><a class=author href=https://tigeroakes.com>Written by<svg xmlns="http://www.w3.org/2000/svg" height="32" viewBox="0 0 80 16"><title>Tiger Oakes</title><g class="logo-icon logo-icon--monochrome"><g fill="none" stroke="currentcolor"><rect width="13" height="13" x="1.5" y="1.5"/><circle class="eye" cx="5" cy="6" r="1.5"/><circle class="eye" cx="11" cy="6" r="1.5"/><path d="M4.5 7.5V11L7 12.5m4.5-4.9V11L9 12.5"/></g><path fill="currentcolor" d="M8 10.6 9.5 9h-3L8 10.6z"/></g><g class="logo-icon logo-icon--color"><rect width="12" height="12" x="2" y="2" fill="#e67237"/><g class="logo-path" fill="none" stroke="#032030"><circle class="eye" cx="5" cy="6" r="1.5"/><circle class="eye" cx="11" cy="6" r="1.5"/><path d="M4.5 7.5V11L7 12.5m4.5-4.9V11L9 12.5"/></g><path fill="#032030" d="M8 10.6 9.5 9h-3L8 10.6z"/></g><clipPath id="i"><path d="M29 8v6h-3V8h3zm0-1h-3V5h3v2z"/></clipPath><g class="text" fill="none" stroke="currentcolor" opacity=".5"><path d="M23.5 13V7l-.5-.5h-3l-.5-.5V5l.5-.5h7"/><path d="M28 13l-.5-.5V6" clip-path="url(#i)"/><path d="M32.5 12.5H30l-.5-.5V8l.5-.5h3l.5.5v7l-.5.5h-3l-.5-.5"/><path d="M36.5 10h2l.5-.5V8l-.5-.5H36l-.5.5v4l.5.5h2.5l.5-.5"/><path d="M40.5 7.5l.5.5v4l.5.5h.5l.5-.5V8l.5-.5h1.5l.5.5"/><path d="M55.5 12.5H51l-.5-.5V5l.5-.5h4l.5.5v6"/><path d="M57.5 8l.5-.5h3l.5.5v4l-.5.5h-3l-.5-.5v-2l.5-.5h2"/><path d="M63 13l.5-.5V4"/><path d="M66.5 6v2l-.5.5h-.5L65 9v1l.5.5h2l.5.5v2"/><path d="M71 10h2l.5-.5V8l-.5-.5h-2.5L70 8v4l.5.5H73l.5-.5"/><path d="M75.5 12l.5.5h3l.5-.5v-1.5L79 10h-3l-.5-.5V8l.5-.5h3l.5.5"/></g><g class="text text-over" fill="none" stroke="currentcolor"><path style="animation-delay:.2s" d="M23.5 13V7l-.5-.5h-3l-.5-.5V5l.5-.5h7"/><path style="animation-delay:.5s" d="M28 13l-.5-.5V6" clip-path="url(#i)"/><path style="animation-delay:.8s" d="M32.5 12.5H30l-.5-.5V8l.5-.5h3l.5.5v7l-.5.5h-3l-.5-.5"/><path style="animation-delay:1.1s" d="M36.5 10h2l.5-.5V8l-.5-.5H36l-.5.5v4l.5.5h2.5l.5-.5"/><path style="animation-delay:1.4s" d="M40.5 7.5l.5.5v4l.5.5h.5l.5-.5V8l.5-.5h1.5l.5.5"/><path style="animation-delay:.2s" d="M55.5 12.5H51l-.5-.5V5l.5-.5h4l.5.5v6"/><path style="animation-delay:.5s" d="M57.5 8l.5-.5h3l.5.5v4l-.5.5h-3l-.5-.5v-2l.5-.5h2"/><path style="animation-delay:.8s" d="M63 13l.5-.5V4"/><path style="animation-delay:1.1s" d="M66.5 6v2l-.5.5h-.5L65 9v1l.5.5h2l.5.5v2"/><path style="animation-delay:1.4s" d="M71 10h2l.5-.5V8l-.5-.5h-2.5L70 8v4l.5.5H73l.5-.5"/><path style="animation-delay:1.7s" d="M75.5 12l.5.5h3l.5-.5v-1.5L79 10h-3l-.5-.5V8l.5-.5h3l.5.5"/></g></svg></a><ul><li><a href=/mockk-guidebook/docs/getting-started/>Getting Started</a><ul><li><a href=/mockk-guidebook/docs/getting-started/why-mocking/>Why use mocks</a></li><li><a href=/mockk-guidebook/docs/getting-started/why-mockk/><del>Why MockK</del></a></li></ul></li><li><a href=/mockk-guidebook/docs/quick/android/>Android Quickstart</a></li><li><a href=/mockk-guidebook/docs/mocking/><strong>Mocking</strong></a><ul><li><a href=/mockk-guidebook/docs/mocking/stubbing/>Stub out behaviour</a></li><li><a href=/mockk-guidebook/docs/mocking/verify/>Verify that functions were called</a></li><li><a href=/mockk-guidebook/docs/mocking/relax/>Automatically stub by relaxing</a></li><li><a href=/mockk-guidebook/docs/mocking/spy/>Spy on existing classes</a></li><li><a href=/mockk-guidebook/docs/mocking/coroutines/>Coroutines and suspend functions</a></li><li><a href=/mockk-guidebook/docs/mocking/constructor/>Mock constructors in code you don&rsquo;t own</a></li><li><a href=/mockk-guidebook/docs/mocking/static/>Mock singleton objects and static methods</a></li><li><a href=/mockk-guidebook/docs/mocking/extension/>Mock top-level and extension functions</a></li><li><a href=/mockk-guidebook/docs/mocking/clear/><del>Clear state</del></a></li><li><a href=/mockk-guidebook/docs/mocking/annotation/>Create many mocks quickly with annotations</a></li><li><a href=/mockk-guidebook/docs/mocking/hierarchies/><del>Chain mocks into hierarchies</del></a></li><li><a href=/mockk-guidebook/docs/mocking/answers/ class=active>Create more complicated answers for stubs</a></li></ul></li><li><a href=/mockk-guidebook/docs/matching/><strong>Argument matching</strong></a><ul><li><a href=/mockk-guidebook/docs/matching/equal/><del>Check equality</del></a></li><li><a href=/mockk-guidebook/docs/matching/any/><del>Allow any argument</del></a></li><li><a href=/mockk-guidebook/docs/matching/oftype/><del>Argument of a certain type</del></a></li><li><a href=/mockk-guidebook/docs/matching/with/>Assertions with an argument</a></li><li><a href=/mockk-guidebook/docs/matching/custom/>Custom matching functions</a></li><li><a href=/mockk-guidebook/docs/matching/capture/><del>Capture arguments to check later</del></a></li><li><a href=/mockk-guidebook/docs/matching/vararg/><del>Variable arguments</del></a></li><li><a href=/mockk-guidebook/docs/matching/compareto/>Comparables</a></li><li><a href=/mockk-guidebook/docs/matching/combine/><del>Combine matchers</del></a></li></ul></li><li><a href=/mockk-guidebook/docs/mockito-migrate/><strong>Migrating from Mockito</strong></a><ul><li><a href=/mockk-guidebook/docs/mockito-migrate/create-mock/>Create a mock</a></li><li><a href=/mockk-guidebook/docs/mockito-migrate/when/><code>when</code> and <code>do*</code></a></li><li><a href=/mockk-guidebook/docs/mockito-migrate/eq/><code>eq</code></a></li><li><a href=/mockk-guidebook/docs/mockito-migrate/any/><code>any*</code></a></li><li><a href=/mockk-guidebook/docs/mockito-migrate/verify/><code>verify</code></a></li><li><a href=/mockk-guidebook/docs/mockito-migrate/arg-that/><code>argThat</code></a></li><li><a href=/mockk-guidebook/docs/mockito-migrate/argument-captor/><code>ArgumentCaptor</code></a></li><li><a href=/mockk-guidebook/docs/mockito-migrate/void/><code>void</code> methods</a></li></ul></li><li><a href=/mockk-guidebook/docs/tips/><strong>Tips</strong></a><ul><li><a href=/mockk-guidebook/docs/tips/unit/>Return <code>Unit</code></a></li><li><a href=/mockk-guidebook/docs/tips/chains/><del>Chains</del></a></li><li><a href=/mockk-guidebook/docs/tips/timeout/><del>Timeouts</del></a></li><li><a href=/mockk-guidebook/docs/tips/exclude/><del>Exclude recording</del></a></li></ul></li><li><a href=/mockk-guidebook/docs/method-index/>Method index</a></li></ul><ul><li><a href=https://github.com/NotWoods/mockk-guidebook/ target=_blank rel=noopener>Github</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/mockk-guidebook/svg/menu.svg class=book-icon alt=Menu></label>
<label for=toc-control><img src=/mockk-guidebook/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><ul><li><a href=#side-effects>Side effects</a></li><li><a href=#answer-scope>Answer scope</a><ul><li><a href=#individual-arguments>Individual arguments</a></li><li><a href=#all-arguments>All arguments</a></li></ul></li></ul></li></ul></nav><div class=dark data-ea-publisher=notwoodsgithubio-mockk-guidebook data-ea-type=image id=toc-sidebar-ad data-ea-manual=true></div></aside></header><div class=dark data-ea-publisher=notwoodsgithubio-mockk-guidebook data-ea-type=text id=content-ad data-ea-manual=true></div><article class=markdown><p>Most
<a href=/mockk-guidebook/docs/mocking/stubbing/>stubs</a> will use <code>returns</code> to always return the same value when the corresponding method is called. Sometimes, the method you&rsquo;re trying to mock may be more complicated and require a more advanced stub.</p><p>If you want to change the result of a mocked method depending on its arguments, run additional code whenever a method is called, or just print out &ldquo;Hello world&rdquo; when a mock is used, <code>answers</code> is the tool you&rsquo;ll want to use.</p><p><code>answers</code> takes the place of <code>returns</code> after an <code>every</code> call. When using <code>returns</code>, it should be followed by a value to return. When using <code>answers</code>, it should be followed by a lambda function that is run when the mocked method is called.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>import</span> io.mockk.every
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> io.mockk.mockk
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>val</span> navigator = mockk&lt;Navigator&gt;()
</span></span><span style=display:flex><span>every { navigator.currentLocation } returns <span style=color:#e6db74>&#34;Home&#34;</span>
</span></span><span style=display:flex><span>every { navigator.currentLocation } answers { <span style=color:#e6db74>&#34;Home&#34;</span> }
</span></span></code></pre></div><h2 id=side-effects>Side effects
<a class=anchor href=#side-effects>#</a></h2><p>A function has &ldquo;side effects&rdquo; if it does something other than just returning a value, such as logging or mutating some outside state. <code>answers</code> lets you model side effects by putting additional statements inside its lambda function.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span>every { navigator.currentLocation } answers {
</span></span><span style=display:flex><span>  println(<span style=color:#e6db74>&#34;Hello world!&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;Work&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// prints &#34;Hello world!&#34;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>val</span> location = navigator.currentLocation
</span></span><span style=display:flex><span><span style=color:#75715e>// prints &#34;Work&#34;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>println(location)
</span></span></code></pre></div><h2 id=answer-scope>Answer scope
<a class=anchor href=#answer-scope>#</a></h2><p>Inside of the <code>answers</code> lambda function, you can access information about the mocked method and how it was called. You can then use this to adjust the resulting answer.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span>every { navigator.navigateTo(any()) } answers {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>val</span> destination = firstArg&lt;String&gt;()
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>throw</span> IllegalStateException(<span style=color:#e6db74>&#34;Can&#39;t reach </span><span style=color:#e6db74>$destination</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>These values are properties on the
<a href=https://mockk.io/#answer-scope><code>MockKAnswerScope</code></a> class. The scope is passed as a
<a href=https://kotlinlang.org/docs/reference/lambdas.html#function-literals-with-receiver>receiver object</a>, allowing variables to be called from the implicit <code>this</code> scope.</p><h3 id=individual-arguments>Individual arguments
<a class=anchor href=#individual-arguments>#</a></h3><p>Single arugments can be obtained using <code>firstArg()</code>, <code>secondArg()</code>, <code>thirdArg()</code>, and <code>lastArg()</code>. Other arguments can be obtained with <code>arg(n)</code>, where <code>n</code> is the index of the argument. For example, <code>arg(3)</code> would return the fourth argument.</p><p>Arguments do not have static type checking. Instead, the type is casted automatically using generic types.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span>every { calculator.add(any&lt;Int&gt;(), any&lt;Int&gt;()) } answers {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// tries to cast the second argument to a string
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  println(secondArg&lt;String&gt;())
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>The above code will compile, but when the test is run a <code>ClassCastException</code> will be thrown because you cannot cast an <code>Int</code> to a <code>String</code>.</p><h3 id=all-arguments>All arguments
<a class=anchor href=#all-arguments>#</a></h3><p>The entire list of arguments can be obtained using <code>args</code>. <code>args</code> has the type <code>List&lt;Any?></code>, so you will need to manually cast values in the list if you want to work with them.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span>every { calculator.add(any&lt;Int&gt;(), any&lt;Int&gt;()) } answers {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>val</span> numbers = args <span style=color:#66d9ef>as</span> List&lt;Int&gt;
</span></span><span style=display:flex><span>  numbers.sum()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// prints &#34;4&#34;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>println(calculator.add(<span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>2</span>))
</span></span></code></pre></div><p>If you only need to know the length of <code>args</code>, aka the number of arguments, you can use <code>nArgs</code>.</p><p>TODO <code>call</code>, <code>invocation</code>, <code>matcher</code>, <code>self</code>, <code>method</code>, <code>captured</code>, <code>lambda</code>, <code>coroutine</code>, <code>nothing</code>, <code>fieldValue</code>, <code>fieldValueAny</code>, <code>value</code>, <code>valueAny</code>.</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/NotWoods/mockk-guidebook//commit/1b7fdb79f9778cd8c12eb5878b240747a1ac32e9 title='Last modified by Tiger Oakes | August 15, 2023' target=_blank rel=noopener><img src=/mockk-guidebook/svg/calendar.svg class=book-icon alt=Calendar>
<span>August 15, 2023</span></a></div><div><a class="flex align-center" href=https://github.com/NotWoods/mockk-guidebook//edit/main/content/docs/mocking/answers.md target=_blank rel=noopener><img src=/mockk-guidebook/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div></div><script>(function(){function e(n){const e=window.getSelection(),t=document.createRange();t.selectNodeContents(n),e.removeAllRanges(),e.addRange(t)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script><a class=kofi href=https://ko-fi.com/O4O645BF3 target=_blank><img height=36 width=141 style=height:36px;width:141px loading=lazy src="https://cdn.ko-fi.com/cdn/kofi2.png?v=2" alt="Buy Me a Coffee at ko-fi.com"></a></footer><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><ul><li><a href=#side-effects>Side effects</a></li><li><a href=#answer-scope>Answer scope</a><ul><li><a href=#individual-arguments>Individual arguments</a></li><li><a href=#all-arguments>All arguments</a></li></ul></li></ul></li></ul></nav><div class=dark data-ea-publisher=notwoodsgithubio-mockk-guidebook data-ea-type=image id=toc-sidebar-ad data-ea-manual=true></div></div></aside></main></body></html>