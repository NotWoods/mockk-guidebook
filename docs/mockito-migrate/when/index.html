<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="when(x).thenReturn(y), doReturn, and more."><meta name=theme-color content="#343a40"><meta name=color-scheme content="light dark"><title>`when` and `do*` | Migrating from Mockito | MockK Guidebook</title><link rel=manifest href=/mockk-guidebook/manifest.json><link rel=icon href=/mockk-guidebook/favicon.png sizes=48x48 type=image/png><link rel=icon href=/mockk-guidebook/favicon.svg sizes=any type=image/svg+xml><link rel=stylesheet href=/mockk-guidebook/book.min.66a7ae0ec09df2dfc58bfb0d30143af7a784be481cd37bc1e244295eb417133f.css integrity="sha256-ZqeuDsCd8t/Fi/sNMBQ696eEvkgc03vB4kQpXrQXEz8=" crossorigin=anonymous><script defer src=/mockk-guidebook/flexsearch.min.js></script>
<script defer src=/mockk-guidebook/en.search.min.6656608c074488bebb37b073f2f7078c1a0b366dfc28194132a556f11ef533d7.js integrity="sha256-ZlZgjAdEiL67N7Bz8vcHjBoLNm38KBlBMqVW8R71M9c=" crossorigin=anonymous></script><meta name=monetization content="$ilp.uphold.com/p2WKq3nJHA8w"><script defer src=https://media.ethicalads.io/media/client/ethicalads.min.js></script>
<script defer src=/mockk-guidebook/ads.min.js></script>
<script defer src=/mockk-guidebook/keys.min.js></script>
<script src=https://typed-thirtyfive.tigeroakes.com/script.js data-site=BZTAEHGH defer></script><meta property="og:title" content="`when` and `do*`"><meta property="og:site_name" content="MockK Guidebook"><meta property="og:type" content="book"><meta property="og:image" content="https://notwoods.github.io/mockk-guidebook/cover/mockk-bike-iso.png"><meta property="og:image:width" content="1280"><meta property="og:image:height" content="640"><meta property="og:url" content="https://notwoods.github.io/mockk-guidebook/docs/mockito-migrate/when/"><meta name=twitter:card content="summary_large_image"><meta name=twitter:creator content="@Not_Woods"><meta name=twitter:title content="`when` and `do*` | MockK Guidebook"><meta name=twitter:image content="https://notwoods.github.io/mockk-guidebook/cover/mockk-bike-iso.png"><meta name=twitter:description content="when(x).thenReturn(y), doReturn, and more."></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control accesskey=*>
<input type=checkbox class="hidden toggle" id=toc-control accesskey=#><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/mockk-guidebook/><span>MockK Guidebook</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><a class=author href=https://tigeroakes.com>Written by<svg xmlns="http://www.w3.org/2000/svg" height="32" viewBox="0 0 80 16"><title>Tiger Oakes</title><g class="logo-icon logo-icon--monochrome"><g fill="none" stroke="currentcolor"><rect width="13" height="13" x="1.5" y="1.5"/><circle class="eye" cx="5" cy="6" r="1.5"/><circle class="eye" cx="11" cy="6" r="1.5"/><path d="M4.5 7.5V11L7 12.5m4.5-4.9V11L9 12.5"/></g><path fill="currentcolor" d="M8 10.6 9.5 9h-3L8 10.6z"/></g><g class="logo-icon logo-icon--color"><rect width="12" height="12" x="2" y="2" fill="#e67237"/><g class="logo-path" fill="none" stroke="#032030"><circle class="eye" cx="5" cy="6" r="1.5"/><circle class="eye" cx="11" cy="6" r="1.5"/><path d="M4.5 7.5V11L7 12.5m4.5-4.9V11L9 12.5"/></g><path fill="#032030" d="M8 10.6 9.5 9h-3L8 10.6z"/></g><clipPath id="i"><path d="M29 8v6h-3V8h3zm0-1h-3V5h3v2z"/></clipPath><g class="text" fill="none" stroke="currentcolor" opacity=".5"><path d="M23.5 13V7l-.5-.5h-3l-.5-.5V5l.5-.5h7"/><path d="M28 13l-.5-.5V6" clip-path="url(#i)"/><path d="M32.5 12.5H30l-.5-.5V8l.5-.5h3l.5.5v7l-.5.5h-3l-.5-.5"/><path d="M36.5 10h2l.5-.5V8l-.5-.5H36l-.5.5v4l.5.5h2.5l.5-.5"/><path d="M40.5 7.5l.5.5v4l.5.5h.5l.5-.5V8l.5-.5h1.5l.5.5"/><path d="M55.5 12.5H51l-.5-.5V5l.5-.5h4l.5.5v6"/><path d="M57.5 8l.5-.5h3l.5.5v4l-.5.5h-3l-.5-.5v-2l.5-.5h2"/><path d="M63 13l.5-.5V4"/><path d="M66.5 6v2l-.5.5h-.5L65 9v1l.5.5h2l.5.5v2"/><path d="M71 10h2l.5-.5V8l-.5-.5h-2.5L70 8v4l.5.5H73l.5-.5"/><path d="M75.5 12l.5.5h3l.5-.5v-1.5L79 10h-3l-.5-.5V8l.5-.5h3l.5.5"/></g><g class="text text-over" fill="none" stroke="currentcolor"><path style="animation-delay:.2s" d="M23.5 13V7l-.5-.5h-3l-.5-.5V5l.5-.5h7"/><path style="animation-delay:.5s" d="M28 13l-.5-.5V6" clip-path="url(#i)"/><path style="animation-delay:.8s" d="M32.5 12.5H30l-.5-.5V8l.5-.5h3l.5.5v7l-.5.5h-3l-.5-.5"/><path style="animation-delay:1.1s" d="M36.5 10h2l.5-.5V8l-.5-.5H36l-.5.5v4l.5.5h2.5l.5-.5"/><path style="animation-delay:1.4s" d="M40.5 7.5l.5.5v4l.5.5h.5l.5-.5V8l.5-.5h1.5l.5.5"/><path style="animation-delay:.2s" d="M55.5 12.5H51l-.5-.5V5l.5-.5h4l.5.5v6"/><path style="animation-delay:.5s" d="M57.5 8l.5-.5h3l.5.5v4l-.5.5h-3l-.5-.5v-2l.5-.5h2"/><path style="animation-delay:.8s" d="M63 13l.5-.5V4"/><path style="animation-delay:1.1s" d="M66.5 6v2l-.5.5h-.5L65 9v1l.5.5h2l.5.5v2"/><path style="animation-delay:1.4s" d="M71 10h2l.5-.5V8l-.5-.5h-2.5L70 8v4l.5.5H73l.5-.5"/><path style="animation-delay:1.7s" d="M75.5 12l.5.5h3l.5-.5v-1.5L79 10h-3l-.5-.5V8l.5-.5h3l.5.5"/></g></svg></a><ul><li><a href=/mockk-guidebook/docs/getting-started/>Getting Started</a><ul><li><a href=/mockk-guidebook/docs/getting-started/why-mocking/>Why use mocks</a></li><li><a href=/mockk-guidebook/docs/getting-started/why-mockk/><del>Why MockK</del></a></li></ul></li><li><a href=/mockk-guidebook/docs/quick/android/>Android Quickstart</a></li><li><a href=/mockk-guidebook/docs/mocking/><strong>Mocking</strong></a><ul><li><a href=/mockk-guidebook/docs/mocking/stubbing/>Stub out behaviour</a></li><li><a href=/mockk-guidebook/docs/mocking/verify/>Verify that functions were called</a></li><li><a href=/mockk-guidebook/docs/mocking/relax/>Automatically stub by relaxing</a></li><li><a href=/mockk-guidebook/docs/mocking/spy/>Spy on existing classes</a></li><li><a href=/mockk-guidebook/docs/mocking/coroutines/>Coroutines and suspend functions</a></li><li><a href=/mockk-guidebook/docs/mocking/constructor/>Mock constructors in code you don&rsquo;t own</a></li><li><a href=/mockk-guidebook/docs/mocking/static/>Mock singleton objects and static methods</a></li><li><a href=/mockk-guidebook/docs/mocking/extension/>Mock top-level and extension functions</a></li><li><a href=/mockk-guidebook/docs/mocking/clear/><del>Clear state</del></a></li><li><a href=/mockk-guidebook/docs/mocking/annotation/>Create many mocks quickly with annotations</a></li><li><a href=/mockk-guidebook/docs/mocking/hierarchies/><del>Chain mocks into hierarchies</del></a></li><li><a href=/mockk-guidebook/docs/mocking/answers/>Create more complicated answers for stubs</a></li></ul></li><li><a href=/mockk-guidebook/docs/matching/><strong>Argument matching</strong></a><ul><li><a href=/mockk-guidebook/docs/matching/equal/><del>Check equality</del></a></li><li><a href=/mockk-guidebook/docs/matching/any/><del>Allow any argument</del></a></li><li><a href=/mockk-guidebook/docs/matching/oftype/><del>Argument of a certain type</del></a></li><li><a href=/mockk-guidebook/docs/matching/with/>Assertions with an argument</a></li><li><a href=/mockk-guidebook/docs/matching/custom/>Custom matching functions</a></li><li><a href=/mockk-guidebook/docs/matching/capture/><del>Capture arguments to check later</del></a></li><li><a href=/mockk-guidebook/docs/matching/vararg/><del>Variable arguments</del></a></li><li><a href=/mockk-guidebook/docs/matching/compareto/>Comparables</a></li><li><a href=/mockk-guidebook/docs/matching/combine/><del>Combine matchers</del></a></li></ul></li><li><a href=/mockk-guidebook/docs/mockito-migrate/><strong>Migrating from Mockito</strong></a><ul><li><a href=/mockk-guidebook/docs/mockito-migrate/create-mock/>Create a mock</a></li><li><a href=/mockk-guidebook/docs/mockito-migrate/when/ class=active><code>when</code> and <code>do*</code></a></li><li><a href=/mockk-guidebook/docs/mockito-migrate/eq/><code>eq</code></a></li><li><a href=/mockk-guidebook/docs/mockito-migrate/any/><code>any*</code></a></li><li><a href=/mockk-guidebook/docs/mockito-migrate/verify/><code>verify</code></a></li><li><a href=/mockk-guidebook/docs/mockito-migrate/arg-that/><code>argThat</code></a></li><li><a href=/mockk-guidebook/docs/mockito-migrate/argument-captor/><code>ArgumentCaptor</code></a></li><li><a href=/mockk-guidebook/docs/mockito-migrate/void/><code>void</code> methods</a></li></ul></li><li><a href=/mockk-guidebook/docs/tips/><strong>Tips</strong></a><ul><li><a href=/mockk-guidebook/docs/tips/unit/>Return <code>Unit</code></a></li><li><a href=/mockk-guidebook/docs/tips/chains/><del>Chains</del></a></li><li><a href=/mockk-guidebook/docs/tips/timeout/><del>Timeouts</del></a></li><li><a href=/mockk-guidebook/docs/tips/exclude/><del>Exclude recording</del></a></li></ul></li><li><a href=/mockk-guidebook/docs/method-index/>Method index</a></li></ul><ul><li><a href=https://github.com/NotWoods/mockk-guidebook/ target=_blank rel=noopener>Github</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/mockk-guidebook/svg/menu.svg class=book-icon alt=Menu></label>
<label for=toc-control><img src=/mockk-guidebook/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#when-and-do><code>when</code> and <code>do*</code></a><ul><li><a href=#thenreturndoreturn><code>thenReturn</code>/<code>doReturn</code></a></li><li><a href=#thenthrowdothrow><code>thenThrow</code>/<code>doThrow</code></a></li><li><a href=#donothing><code>doNothing</code></a></li><li><a href=#thenanswerthendoanswer><code>thenAnswer</code>/<code>then</code>/<code>doAnswer</code></a></li><li><a href=#consecutive-calls>Consecutive calls</a></li><li><a href=#coroutines>Coroutines</a></li></ul></li></ul></nav><div class=dark data-ea-publisher=notwoodsgithubio-mockk-guidebook data-ea-type=image id=toc-sidebar-ad data-ea-manual=true></div></aside></header><div class=dark data-ea-publisher=notwoodsgithubio-mockk-guidebook data-ea-type=text id=content-ad data-ea-manual=true></div><article class=markdown><h1 id=when-and-do><code>when</code> and <code>do*</code>
<a class=anchor href=#when-and-do>#</a></h1><p>Mockito provides two similar approaches for stubbing behaviour on a mock: the <code>when</code> method and the <code>do*</code> family of methods.</p><p>Most stubs in Mockito are written with <code>when</code> at the beginning of the line, following the format &ldquo;<strong>when</strong> the method is called <strong>then</strong> return something&rdquo;. Stubs written with the <code>when</code> method look like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>val</span> mockedFile = mock(File<span style=color:#f92672>::</span><span style=color:#66d9ef>class</span>.java)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>`when`(mockedFile.read()).thenReturn(<span style=color:#e6db74>&#34;hello world&#34;</span>)
</span></span></code></pre></div><p>Sometimes this syntax cannot be used in Mockito, so an alternative approach is available. <code>doReturn</code> and the related <code>doThrow</code>, <code>doAnswer</code>, <code>doNothing</code>, and <code>doCallRealMethod</code> methods are used for void methods, spies, and other occasions where the <code>when</code> method cannot be used. Stubs written with the <code>do*</code> family of methods look like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>val</span> mockedFile = mock(File<span style=color:#f92672>::</span><span style=color:#66d9ef>class</span>.java)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>doReturn(<span style=color:#e6db74>&#34;hello world&#34;</span>).`when`(mockedFile).read()
</span></span></code></pre></div><p>In MockK, all
<a href=/mockk-guidebook/docs/mocking/stubbing/>stubs</a> can be written with the <code>every</code> method. <code>every</code> starts a stubbing block and uses anonymous functions and
<a href=https://kotlinlang.org/docs/reference/functions.html#infix-notation>infix functions</a> to define the stub. The syntax looks like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>val</span> mockedFile = mockk&lt;File&gt;()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>every { mockedFile.read() } returns <span style=color:#e6db74>&#34;hello world&#34;</span>
</span></span></code></pre></div><p>MockK provides alternatives for many types of answers that Mockito supports for stubbing.</p><h2 id=thenreturndoreturn><code>thenReturn</code>/<code>doReturn</code>
<a class=anchor href=#thenreturndoreturn>#</a></h2><p>Returning a value is probably the most common stub to create. In Mockito, the syntax can look like one of two approaches:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>val</span> mockedFile = mock(File<span style=color:#f92672>::</span><span style=color:#66d9ef>class</span>.java)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>`when`(mockedFile.read()).thenReturn(<span style=color:#e6db74>&#34;hello world&#34;</span>)
</span></span><span style=display:flex><span>doReturn(<span style=color:#e6db74>&#34;hello world&#34;</span>).`when`(mockedFile).read()
</span></span></code></pre></div><p>In MockK, an infix function is used instead.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>val</span> mockedFile = mockk&lt;File&gt;()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>every { mockedFile.read() } returns <span style=color:#e6db74>&#34;hello world&#34;</span>
</span></span></code></pre></div><h2 id=thenthrowdothrow><code>thenThrow</code>/<code>doThrow</code>
<a class=anchor href=#thenthrowdothrow>#</a></h2><p>Rather than returning values, stubs can throw errors. Mockito lets exceptions be specified with one of two approaches:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>val</span> mockedFile = mock(File<span style=color:#f92672>::</span><span style=color:#66d9ef>class</span>.java)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>`when`(mockedFile.read()).thenThrow(RuntimeException())
</span></span><span style=display:flex><span>doThrow(RuntimeException()).`when`(mockedFile).read()
</span></span></code></pre></div><p>MockK provides the <code>throws</code> infix method to throw in stubs.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>val</span> mockedFile = mockk&lt;File&gt;()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>every { mockedFile.read() } throws RuntimeException()
</span></span></code></pre></div><h2 id=donothing><code>doNothing</code>
<a class=anchor href=#donothing>#</a></h2><p>See
<a href=/mockk-guidebook/docs/mockito-migrate/void/>Migrating from Mockito: <code>void</code> methods</a></p><h2 id=thenanswerthendoanswer><code>thenAnswer</code>/<code>then</code>/<code>doAnswer</code>
<a class=anchor href=#thenanswerthendoanswer>#</a></h2><p>Mockito allows arbitrary callbacks to be used for stubs with the <code>Answer</code> interface. <code>Answer</code> only contains a single method, so Kotlin allows a function literal to be used instead through
<a href=https://kotlinlang.org/docs/reference/java-interop.html#sam-conversions>SAM conversion</a>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>val</span> mockedFile = mock(File<span style=color:#f92672>::</span><span style=color:#66d9ef>class</span>.java)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>`when`(mockedFile.write(any())).thenAnswer { invocation <span style=color:#f92672>-&gt;</span>
</span></span><span style=display:flex><span>  println(<span style=color:#e6db74>&#34;called with arguments: &#34;</span> + invocation.arguments.joinToString())
</span></span><span style=display:flex><span>  Unit
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>`when`(mockedFile.write(any())).then { invocation <span style=color:#f92672>-&gt;</span>
</span></span><span style=display:flex><span>  println(<span style=color:#e6db74>&#34;called with arguments: &#34;</span> + invocation.arguments.joinToString())
</span></span><span style=display:flex><span>  Unit
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>doAnswer { invocation <span style=color:#f92672>-&gt;</span>
</span></span><span style=display:flex><span>  println(<span style=color:#e6db74>&#34;called with arguments: &#34;</span> + invocation.arguments.joinToString())
</span></span><span style=display:flex><span>  Unit
</span></span><span style=display:flex><span>}.`when`(mockedFile).write(any())
</span></span></code></pre></div><p>MockK provides an equivalent infix function that also uses function literals.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>val</span> mockedFile = mockk&lt;File&gt;()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>every { mockedFile.write(any()) } answers { call <span style=color:#f92672>-&gt;</span>
</span></span><span style=display:flex><span>  println(<span style=color:#e6db74>&#34;called with arguments: &#34;</span> + call.invocation.args.joinToString())
</span></span><span style=display:flex><span>  Unit
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=consecutive-calls>Consecutive calls
<a class=anchor href=#consecutive-calls>#</a></h2><p>Mockito additionally lets different return values be stubbed for the same method call, such as for mocking an iterator.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>val</span> mockedFile = mock(File<span style=color:#f92672>::</span><span style=color:#66d9ef>class</span>.java)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Chain multiple calls
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>`when`(mockedFile.read()).thenReturn(<span style=color:#e6db74>&#34;read 1&#34;</span>).thenReturn(<span style=color:#e6db74>&#34;read 2&#34;</span>).thenReturn(<span style=color:#e6db74>&#34;read 3&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#75715e>// Shorthand
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>`when`(mockedFile.read()).thenReturn(<span style=color:#e6db74>&#34;read 1&#34;</span>, <span style=color:#e6db74>&#34;read 2&#34;</span>, <span style=color:#e6db74>&#34;read 3&#34;</span>)
</span></span><span style=display:flex><span>doReturn(<span style=color:#e6db74>&#34;read 1&#34;</span>, <span style=color:#e6db74>&#34;read 2&#34;</span>, <span style=color:#e6db74>&#34;read 3&#34;</span>).`when`(mockedFile).read()
</span></span><span style=display:flex><span><span style=color:#75715e>// Use different answer types
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>`when`(mockedFile.read())
</span></span><span style=display:flex><span>  .thenReturn(<span style=color:#e6db74>&#34;successful read&#34;</span>)
</span></span><span style=display:flex><span>  .thenThrow(RuntimeException())
</span></span></code></pre></div><p>Additional answers is supported in MockK using various infix functions.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>val</span> mockedFile = mockk&lt;File&gt;()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Chain multiple calls
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>every { mockedFile.read() } returns <span style=color:#e6db74>&#34;read 1&#34;</span> andThen <span style=color:#e6db74>&#34;read 2&#34;</span> andThen <span style=color:#e6db74>&#34;read 3&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Shorthand using a list
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>every { mockedFile.read() } returnsMany listOf(<span style=color:#e6db74>&#34;read 1&#34;</span>, <span style=color:#e6db74>&#34;read 2&#34;</span>, <span style=color:#e6db74>&#34;read 3&#34;</span>)
</span></span><span style=display:flex><span>every { mockedFile.read() } andThenMany listOf(<span style=color:#e6db74>&#34;read 1&#34;</span>, <span style=color:#e6db74>&#34;read 2&#34;</span>, <span style=color:#e6db74>&#34;read 3&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#75715e>// Use different answer types
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>every { mockedFile.read() } returns <span style=color:#e6db74>&#34;successful read&#34;</span> andThenThrows RuntimeException()
</span></span></code></pre></div><h2 id=coroutines>Coroutines
<a class=anchor href=#coroutines>#</a></h2><p>As MockK uses function literals to create stubs, small changes are needed to stub suspend functions. MockK provides functions prefixed with <code>co</code> as equivalents to other functions, such as <code>coEvery</code> and <code>coAnswers</code>. See
<a href=/mockk-guidebook/docs/mocking/coroutines/>Coroutines and suspend functions</a> for more details.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>val</span> mockedFile = mockk&lt;File&gt;()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>coEvery { mockedFile.readAsync() } returns <span style=color:#e6db74>&#34;hello world&#34;</span>
</span></span><span style=display:flex><span>coEvery { mockedFile.writeAsync(any()) } coAnswers { call <span style=color:#f92672>-&gt;</span>
</span></span><span style=display:flex><span>  doAsyncWork()
</span></span><span style=display:flex><span>  Unit
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/NotWoods/mockk-guidebook//commit/2be0da33ecc6d38f2e8c26db78796e2667967be6 title='Last modified by Tiger Oakes | January 28, 2023' target=_blank rel=noopener><img src=/mockk-guidebook/svg/calendar.svg class=book-icon alt=Calendar>
<span>January 28, 2023</span></a></div><div><a class="flex align-center" href=https://github.com/NotWoods/mockk-guidebook//edit/main/content/docs/mockito-migrate/when.md target=_blank rel=noopener><img src=/mockk-guidebook/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div></div><script>(function(){function e(n){const e=window.getSelection(),t=document.createRange();t.selectNodeContents(n),e.removeAllRanges(),e.addRange(t)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script><a class=kofi href=https://ko-fi.com/O4O645BF3 target=_blank><img height=36 width=141 style=height:36px;width:141px loading=lazy src="https://cdn.ko-fi.com/cdn/kofi2.png?v=2" alt="Buy Me a Coffee at ko-fi.com"></a></footer><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#when-and-do><code>when</code> and <code>do*</code></a><ul><li><a href=#thenreturndoreturn><code>thenReturn</code>/<code>doReturn</code></a></li><li><a href=#thenthrowdothrow><code>thenThrow</code>/<code>doThrow</code></a></li><li><a href=#donothing><code>doNothing</code></a></li><li><a href=#thenanswerthendoanswer><code>thenAnswer</code>/<code>then</code>/<code>doAnswer</code></a></li><li><a href=#consecutive-calls>Consecutive calls</a></li><li><a href=#coroutines>Coroutines</a></li></ul></li></ul></nav><div class=dark data-ea-publisher=notwoodsgithubio-mockk-guidebook data-ea-type=image id=toc-sidebar-ad data-ea-manual=true></div></div></aside></main></body></html>